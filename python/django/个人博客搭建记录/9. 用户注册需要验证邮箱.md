> [email-settings](https://docs.djangoproject.com/en/2.2/ref/settings/#email-backend)
> [email](https://docs.djangoproject.com/en/2.2/topics/email/)
1. 修改用户注册需要验证邮箱
```python
# 修改注册视图函数,用户注册时帐号不激活，无法登录，验证邮箱之后才可激活
# 新增注册结果视图函数，后续修改个人信息也可用
# accounts/views.py
from django.conf import settings
from django.utils import timezone
from django.http import HttpResponseRedirect
from django.core.mail import EmailMultiAlternatives

from .forms import RegisterForm, LoginForm, ChangeEmailForm
from my_blog.utils import get_current_site, get_md5

def register(request):
    """
    注册视图
    :param request:
    :return:
    """
    if request.method == 'POST':
        # 传递post数据
        reg_form = RegisterForm(request.POST)
        # 数据验证
        if reg_form.is_valid():
            username = reg_form.cleaned_data['username']
            email = reg_form.cleaned_data['email']
            password = reg_form.cleaned_data['password']
            # 保存用户
            user = User.objects.create_user(username, email, password)
            # 状态为未激活，验证邮箱之后激活账户
            user.is_active = False
            user.save()
            # 如果有昵称，则保存
            # nickname = reg_form.cleaned_data['nickname']
            # if nickname:
            #     profile = Profile(user=user)
            #     profile.nickname = nickname
            #     profile.save()

            # 获取当前站点
            site = get_current_site()
            # 测试环境下为127
            if settings.DEBUG:
                site = '127.0.0.1:8000'

            # 当前日期，验证邮箱链接当天有效
            today = timezone.now().date()
            # 加密参数
            sign = get_md5(get_md5(settings.SECRET_KEY+str(user.pk))+str(today))
            path = reverse('accounts:result')
            url = f'http://{site}{path}?type=validation&id={user.pk}&sign={sign}'
            print(url)
            content =f"""
                            <p>请点击下面链接验证您的邮箱</p>
                            <a href="{url}" rel="bookmark">{url}</a>
                            <p>再次感谢您！</p>
                            <p>如果上面链接无法打开，请将此链接复制至浏览器。<p>
                            <p>{url}<p>
                            """
            # 发送邮件
            msg = EmailMultiAlternatives('邮箱验证', content, from_email=settings.EMAIL_HOST_USER, to=[user.email])
            msg.content_subtype = "html"
            msg.send()

            url = path + f'?type=register&id={str(user.pk)}'
            # 跳转到结果页面
            return HttpResponseRedirect(url)
    else:
        # 初始化注册表单
        reg_form = RegisterForm()

    context = {
        'title': '注册',
        'form': reg_form,
    }

    return render(request, 'accounts/forms.html', context=context)

def result(request):
    type = request.GET.get('type')
    id = request.GET.get('id')
    # 获取用户
    user = get_object_or_404(User, pk=int(id))

    if type == 'register':
        context = {
            'title': '注册成功',
            'content': f'恭喜您注册成功，一封验证邮件已经发送到您的邮箱：{user.email}, 请验证您的邮箱后登录本站。',
        }

    elif type == 'validation':
        sign_url = request.GET.get('sign')
        today = timezone.now().date()
        # 加密参数
        sign = get_md5(get_md5(settings.SECRET_KEY + id) + str(today))

        # 判断加密参数是否相等，相等则验证通过
        if sign == sign_url:
            user.is_active = True
            user.save()
            context = {
                'title': '验证成功',
                'content': '恭喜您完成邮箱验证，您现在可以使用您的账号来登录本站。',
            }
        else:
            context = {
                'title': '验证失败',
                'content': '邮箱验证不通过，请检查url或者重新验证',
            }
    else:
        return redirect(reverse('home'))

    return render(request, 'accounts/result.html', context=context)


# 添加站点app,配置当前SITE_ID，配置邮箱
# my_blog/settings.py
INSTALLED_APPS = [
    'django.contrib.sites',
]

# 当前SITE_ID
SITE_ID = 1

# 配置邮箱
EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
# 是否启动安全链接
EMAIL_USE_TLS = False
EMAIL_HOST = 'smtp.qq.com'
EMAIL_PORT = 25
EMAIL_HOST_USER = config('EMAIL_HOST_USER')
EMAIL_HOST_PASSWORD = config('EMAIL_HOST_PASSWORD')
DEFAULT_FROM_EMAIL = EMAIL_HOST_USER
#前缀
EMAIL_SUBJECT_PREFIX = '[OldestCrab Blog]'


# 添加一些通用的函数
# my_blog/utils.py
from hashlib import md5

from django.contrib.sites.models import Site
def get_current_site():
    """
    获取当前站点
    :return: 当前站点
    """
    site = Site.objects.get_current()
    return site

def get_md5(str):
    """
    对str进行md5加密
    :param str: 字符串
    :return: md5加密后的数据
    """
    m = md5(str.encode('utf-8'))
    return m.hexdigest()


# 添加url
# accounts/urls.py
    path('result', views.result, name='result'),

# 配置前端页面
# templates/accounts/result.html

# 登录验证时提示帐号未激活
# accounts/forms.py
class LoginForm(forms.Form):

    def clean(self):
        user = User.objects.get(username=username)
        if user:
            if not user.is_active:
                raise forms.ValidationError('帐号尚未激活，请先激活帐号！')

```